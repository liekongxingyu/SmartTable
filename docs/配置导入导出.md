# 配置导入导出功能说明

## 📌 功能概述

SmartTable 插件支持完整的配置导入导出功能，方便您：

- 🔄 在不同设备间迁移配置
- 💾 备份重要的表格模板
- 🤝 与他人分享配置方案
- 🔁 快速恢复历史配置

---

## 🎯 导出功能

### 1. **导出完整配置**

包含以下内容：

- ✅ API 配置（端点、密钥、模型）
- ✅ 全局设置（上下文深度、系统提示词等）
- ✅ 表格模板（schema，包括字段定义）
- ✅ 追踪策略（频率、提示词、数量限制等）
- ❌ **不包含**：实际聊天数据

**操作步骤：**

1. 打开 SmartTable 管理面板
2. 进入 **"设置"** 标签页 (⚙️图标)
3. 点击 **"导出完整配置"** 按钮
4. 浏览器自动下载 `smart-table-config.json`

**导出的 JSON 格式：**

```json
{
  "version": "1.0.0",
  "exportTime": "2026-01-30T13:00:00.000Z",
  "config": {
    "api": {
      "endpoint": "https://api.openai.com/v1",
      "key": "sk-xxxxx",
      "model": "gpt-4o"
    },
    "global": {
      "contextDepth": 15,
      "defaultTableMaxRows": 10,
      "systemPrompt": "..."
    },
    "schema": [
      {
        "id": "tasks",
        "title": "任务表",
        "fields": [...],
        "freq": 3,
        "maxRows": 10,
        "prompt": "...",
        ...
      }
    ]
  }
}
```

### 2. **仅导出表配置**

只包含表格模板（schema），不包含 API 和全局设置。

**适用场景：**

- 分享表格模板给他人使用
- 备份表格设计，不泄露 API 密钥

**操作步骤：**

1. 进入"设置"标签页
2. 点击 **"仅导出表配置"** 按钮
3. 下载 `smart-table-schema.json`

**导出格式：**

```json
{
  "version": "1.0.0",
  "exportTime": "2026-01-30T13:00:00.000Z",
  "type": "schema-only",
  "schema": [...]
}
```

---

## 📥 导入功能

### 模式选择

SmartTable 提供两种导入模式：

| 模式         | 按钮                | 行为                     | 适用场景           |
| ------------ | ------------------- | ------------------------ | ------------------ |
| **追加模式** | 🟢 导入配置（追加） | 保留现有配置，追加新表格 | 添加新表模板       |
| **覆盖模式** | 🔴 导入配置（覆盖） | 完全替换现有配置         | 恢复备份、迁移配置 |

### 1. **追加模式导入**

**行为规则：**

- ✅ API 配置：**覆盖**
- ✅ 全局设置：**覆盖**
- ✅ 表格模板：**追加**（跳过重复的 ID）

**操作步骤：**

1. 进入"设置"标签页
2. 点击 **"导入配置（追加）"** 按钮
3. 选择 JSON 文件
4. 插件自动合并配置

**示例：**

```
现有表格: [任务表, 人物表]
导入文件: [任务表, 事件表]

追加结果: [任务表(保留), 人物表(保留), 事件表(新增)]
          ↑ 重复ID被跳过
```

### 2. **覆盖模式导入**

**⚠️ 危险操作：会完全替换现有配置！**

**行为规则：**

- ✅ API 配置：**完全覆盖**
- ✅ 全局设置：**完全覆盖**
- ✅ 表格模板：**完全覆盖**

**操作步骤：**

1. 进入"设置"标签页
2. 点击 **"导入配置（覆盖）"** 按钮
3. 确认警告对话框
4. 选择 JSON 文件
5. 插件完全替换配置

**建议：**

- 使用前先导出当前配置作为备份！
- 适用于设备迁移或恢复历史版本

---

## 🔐 安全提示

### API 密钥保护

导出的配置文件包含 API 密钥，请注意：

- ⚠️ **不要公开分享**完整配置文件
- ✅ 分享给他人时，使用**"仅导出表配置"**
- ✅ 提交到版本控制系统前，手动删除 `api.key` 字段

**清理密钥示例：**

```json
{
  "config": {
    "api": {
      "endpoint": "https://api.openai.com/v1",
      "key": "",  // 🔒 清空密钥
      "model": "gpt-4o"
    },
    ...
  }
}
```

---

## 💡 使用场景

### 场景 1：跨设备同步

```
设备 A                    设备 B
  ↓                        ↓
导出完整配置 ─────────→ 导入配置（覆盖）
```

### 场景 2：分享表格模板

```
你的配置                  朋友的配置
  ↓                        ↓
仅导出表配置 ─────────→ 导入配置（追加）
```

### 场景 3：版本回退

```
修改前                    修改后（出错）
  ↓                        ↓
导出备份（v1） ←──────── 导入备份（覆盖）
```

### 场景 4：模板库管理

维护多个配置文件：

```
configs/
├── basic-config.json      # 基础三表配置
├── advanced-config.json   # 高级五表配置
└── creative-config.json   # 创作专用配置
```

---

## 🛠️ 高级技巧

### 1. 手动编辑配置文件

导出的 JSON 文件可以直接编辑：

```javascript
// 批量修改所有表格的频率
{
  "schema": [
    {"id": "tasks", "freq": 2, ...},  // 改为 2
    {"id": "chars", "freq": 2, ...},  // 改为 2
    ...
  ]
}
```

### 2. 配置文件模板化

创建通用模板，填充变量：

```json
{
  "config": {
    "api": {
      "endpoint": "${API_ENDPOINT}",
      "key": "${API_KEY}",
      ...
    }
  }
}
```

### 3. 配置版本管理

在导出文件名中包含版本信息：

```
smart-table-config-v1.0-2026-01-30.json
smart-table-config-v2.0-2026-02-15.json
```

---

## ⚠️ 注意事项

1. **导入不会影响聊天数据**
   - 只修改配置和模板，不会删除已有的表格数据

2. **ID 冲突处理**
   - 追加模式：跳过重复 ID
   - 覆盖模式：完全替换

3. **版本兼容性**
   - 当前版本：`1.0.0`
   - 未来可能支持版本升级

4. **文件格式验证**
   - 导入时会验证 JSON 格式
   - 如果文件损坏，会显示错误提示

5. **浏览器限制**
   - 文件上传有大小限制（通常 < 10MB）
   - 配置文件通常很小（< 100KB）

---

## 📊 导入导出流程图

```
┌─────────────┐
│  用户操作   │
└──────┬──────┘
       │
   ┌───▼────┐
   │ 导出？ │
   └───┬────┘
       │
    YES│                NO
       │                │
       ▼                ▼
  ┌────────┐       ┌────────┐
  │完整配置│       │仅Schema│
  └───┬────┘       └───┬────┘
      │                │
      └────────┬───────┘
               │
               ▼
        ┌─────────────┐
        │ 生成 JSON   │
        │ 下载文件    │
        └─────────────┘

┌─────────────┐
│  用户选择   │
│  JSON 文件  │
└──────┬──────┘
       │
   ┌───▼────┐
   │ 导入？ │
   └───┬────┘
       │
    YES│
       ▼
  ┌──────────┐
  │追加/覆盖?│
  └─────┬────┘
        │
    ┌───▼───┐
    │ 解析  │
    │ 验证  │
    └───┬───┘
        │
        ▼
   ┌─────────┐
   │ 合并配置│
   └────┬────┘
        │
        ▼
   ┌─────────┐
   │ 保存    │
   │ 刷新UI  │
   └─────────┘
```

---

## 🚀 未来扩展

计划支持的功能：

- 📦 配置模板市场（社区分享）
- 🔄 增量导入（只更新特定表格）
- 📜 导入历史记录
- 🔍 配置差异对比
- 📤 云端备份同步

---

**总结：配置导入导出功能让 SmartTable 的配置管理更加灵活，支持备份、迁移和分享！** 🎉
